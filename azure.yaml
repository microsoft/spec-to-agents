name: microsoft-agent-framework-reference
metadata:
  template: microsoft-agent-framework-reference@latest
  description: Educational platform for learning Microsoft Agent Framework orchestration

infra:
  provider: bicep
  path: infra

services:
  backend:
    project: ./src/backend
    language: python
    host: containerapp
    env:
      AZURE_OPENAI_ENDPOINT: ${AZURE_OPENAI_ENDPOINT}
      AZURE_OPENAI_API_KEY: ${AZURE_OPENAI_API_KEY}
      AZURE_AI_FOUNDRY_ENDPOINT: ${AZURE_AI_FOUNDRY_ENDPOINT}
      COSMOS_ENDPOINT: ${COSMOS_ENDPOINT}
      COSMOS_KEY: ${COSMOS_KEY}
      REDIS_CONNECTION_STRING: ${REDIS_CONNECTION_STRING}
      APPLICATION_INSIGHTS_CONNECTION_STRING: ${APPLICATION_INSIGHTS_CONNECTION_STRING}
      KEY_VAULT_ENDPOINT: ${KEY_VAULT_ENDPOINT}
      SERVICE_BUS_CONNECTION_STRING: ${SERVICE_BUS_CONNECTION_STRING}

hooks:
  predeploy:
    windows:
      shell: pwsh
      run: |
        echo "Installing Python dependencies..."
        cd src/backend
        pip install -r requirements.txt
    posix:
      shell: sh
      run: |
        echo "Installing Python dependencies..."
        cd src/backend
        pip install -r requirements.txt
        
  postprovision:
    windows:
      shell: pwsh
      run: |
        echo "Seeding database with learning scenarios..."
        cd src/backend
        python scripts/seed_database.py
    posix:
      shell: sh
      run: |
        echo "Seeding database with learning scenarios..."
        cd src/backend
        python scripts/seed_database.py

  postdeploy:
    windows:
      shell: pwsh
      run: |
        echo "Running deployment validation..."
        cd src/backend
        python scripts/validate_deployment.py
    posix:
      shell: sh
      run: |
        echo "Running deployment validation..."
        cd src/backend
        python scripts/validate_deployment.py