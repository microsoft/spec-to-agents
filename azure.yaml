# yaml-language-server: $schema=https://raw.githubusercontent.com/Azure/azure-dev/main/schemas/v1.0/azure.yaml.json

name: spec-to-agents
metadata:
  template: spec-to-agents@0.0.1

# Services to deploy
services:
  app:
    project: ./
    language: py
    host: containerapp
    docker:
      path: ./Dockerfile
      context: ./
      remoteBuild: true

# Infrastructure as Code
infra:
  provider: bicep
  path: infra
  module: main

# Deployment hooks
hooks:
  preprovision:
    posix:
      shell: sh
      run: azd env set AZURE_PRINCIPAL_ID $(az ad signed-in-user show --query id -o tsv)
      interactive: false
      continueOnError: false
    windows:
      shell: pwsh
      run: azd env set AZURE_PRINCIPAL_ID (az ad signed-in-user show --query id -o tsv)
      interactive: false
      continueOnError: false

  postprovision:
    windows:
      shell: pwsh
      run: ./scripts/generate-env.ps1
      interactive: false
      continueOnError: false
    posix:
      shell: sh
      run: ./scripts/generate-env.sh
      interactive: false
      continueOnError: false

  postdeploy:
    shell: sh
    run: |
      echo "âœ“ Application deployed successfully!"
      echo "Run 'azd show' to view endpoint URLs."
    continueOnError: true
